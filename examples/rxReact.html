<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>rxjs + react</title>
    <meta name="description" content="Using rxjs with react in a fluxy (reduxy) and about-as-minimal-as-can-get kind of way">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://crosshj.com/footils/web-foo.js"></script>
  </head>

  <body>
    <div class="container col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div id="root" class="panel panel-default panel-success"></div>
    </div>
  </body>

  <script>
    const clone = o => {
      const result = undefined;
      try { result = JSON.parse(JSON.stringify(o)); }
      catch(e) {}
      return result;
    }

    const getRoot = (components, dispatcher) => {
        const { div, textarea, h4, label, fragment, form } = components;
        const action = (type) => (e) => dispatcher({type, payload: e.target.value});

        const root = ({ name = '' }) => fragment([
            div({ key: 'main-title', className: 'panel-heading'},
                h4({ className: 'panel-text' }, 'footils: react with rx as redux')
            ),
            form({ className: 'form-group' }, [
                div({ key: 'form-input', style: {padding: '20px'}}, [
                    label({ key: 'input-title', htmlFor: 'text-input' }, 'Action fired to trigger RX here:'),
                    textarea({
                        key: 'text-input',
                        id: 'text-input',
                        onChange: action('NAME_CHANGED'),
                        placeholder: 'Enter some text',
                        className: 'form-control'
                    }),
                ]),
                div({ key: 'form-ouput', style: {padding: '20px'}}, [
                    label({ key: 'output-title', htmlFor: 'output' }, 'Observable subscribe causes render here:'),
                    textarea({
                        key: 'output',
                        id: 'output',
                        readOnly: true,
                        value: name,
                        placeholder: 'Text shows up here',
                        className: 'form-control'
                    })
                ])
            ])
        ]);

        return root;
    }

    const getReducer = () => {
        const reducer = (state, action) => {
            var newState = clone(state);
            switch(action.type){
                case 'NAME_CHANGED': {
                    newState = Object.assign({}, state, { name: action.payload });
                }
            }
            return newState;
        };
        return reducer;
    };
    
    function rxReactReady(err, { components, dispatcher, start, React } = {}){
        if(err){
            console.error(`Error in rxReactReady: ${err}`)
            return;
        }

        start({
            reducer: getReducer(),
            root: getRoot(components, dispatcher),
            attach: document.getElementById('root')
        });
    }

    footils.rxReact.init(rxReactReady)
  </script>
</html>
