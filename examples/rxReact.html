<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>rxjs + react</title>
    <meta name="description" content="Using rxjs with react in a fluxy (reduxy) and about-as-minimal-as-can-get kind of way">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
  </head>

  <body>
    <div class="container col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">
        <div id="root" class="panel panel-default panel-success"></div>
    </div>
  </body>

  <script src="https://crosshj.com/footils/web-foo.js"></script>

  <script>
    const clone = o => {
      const result = undefined;
      try { result = JSON.parse(JSON.stringify(o)); }
      catch(e) {}
      return result;
    }
    
    function rxReactReady(err, { components, dispatcher, start, React } = {}){
        if(err){
            console.error(`Error in rxReactReady: ${err}`)
            return;
        }
        const { div, textarea, h1, h2, h4, fragment } = components;

        const reducer = (state, action) => {
            var newState = clone(state);
            switch(action.type){
                case 'NAME_CHANGED': {
                    newState = Object.assign({}, state, { name: action.payload });
                }
            }
            return newState;
        };

        const action = (type) => (e) => dispatcher({type, payload: e.target.value});

        const root = ({ name = '' }) => fragment([
            div({ key: 'main-title', className: 'panel-heading'},
                h2({ className: 'panel-text' }, 'footils: react with rx as redux')
            ),
            div({ key: 'form', className: 'form-group', style: {padding: '20px'}}, [
                h4({ key: 'input-title' }, 'Action fired to trigger RX here:'),
                textarea({
                    key: 'text-input',
                    id: 'text-input',
                    onChange: action('NAME_CHANGED'),
                    placeholder: 'Enter some text',
                    className: 'form-control'
                }),
                h4({ key: 'output-title' }, 'Observable subscribe causes render here:'),
                textarea({
                    key: 'output',
                    id: 'output',
                    readOnly: true,
                    value: name,
                    placeholder: 'Text shows up here',
                    className: 'form-control'
                })
            ])
        ]);

        start({
            reducer, root,
            attach: document.getElementById('root')
        });
    }

    footils.rxReact.init(rxReactReady)
  </script>
</html>
